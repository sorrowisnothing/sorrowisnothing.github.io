<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>Searching For JWS</title>
<style>
  body {
    font-family: 'Bodoni MT Condensed', serif;
    background: #fafafa;
    margin: 0;
    display: flex;
    height: 100vh;
    overflow: hidden;
  }

  #left {
    width: 40%;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: flex-start;
    padding: 25px 0 0 60px; /* 标题离边框1.3cm */
  }

  h1 {
    color: black;
    font-size: 5.1em;
    letter-spacing: 1px;
    text-align: left;
    margin-bottom: 30px;
  }

  #image-box {
    width: 100%;
    aspect-ratio: 3/4.1; /* 轻微拉高比例避免裁切过多 */
    overflow: hidden;
    position: relative;
    border-radius: 8px;
  }

  #image-box img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* 铺满容器，无白边 */
    position: absolute;
    opacity: 0;
    transition: opacity 2s ease-in-out;
  }

  #image-box img.active { opacity: 1; }

  #right {
    width: 60%;
    padding: 60px 40px;
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow-y: auto;
  }

  #grid {
    display: grid;
    grid-template-columns: repeat(6, 60px);
    grid-gap: 35px;
    justify-content: center;
    margin-top: 100px;
  }

  .cell {
    width: 60px;
    height: 60px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    cursor: pointer;
    background-color: #23406F;
    transition: transform 0.15s;
  }

  .cell:hover { transform: scale(1.05); }
  .cell.used { background-color: #9C3D34; }

  .popup {
    position: fixed; top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: white; padding: 20px; border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
    width: 360px; display: none;
    font-family: sans-serif;
  }

  textarea { width: 100%; height: 100px; }

  button {
    border: none;
    border-radius: 5px;
    padding: 8px 12px;
    margin-top: 10px;
    cursor: pointer;
  }

  .btn-primary { background: #23406F; color: white; }
  .btn-close { background: #ccc; }

</style>
</head>
<body>
<div id="left">
  <h1>Searching For JWS</h1>
  <div id="image-box">
    <img src="https://i.imgur.com/6lFvwOu.jpeg" class="active">
    <img src="https://i.imgur.com/AVzMUjF.jpeg">
    <img src="https://i.imgur.com/LUldKLJ.jpeg">
    <img src="https://i.imgur.com/KUWaqOv.jpeg">
    <img src="https://i.imgur.com/ci3aMv2.jpeg">
    <img src="https://i.imgur.com/3SkyycN.jpeg">
    <img src="https://i.imgur.com/d2Yd15y.jpeg">
  </div>
</div>

<div id="right">
  <div id="grid"></div>
</div>

<div class="popup" id="popup">
  <div id="popup-content"></div>
  <button class="btn-close" onclick="closePopup()">关闭</button>
</div>

<!-- Firebase SDK -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-database-compat.min.js"></script>

<script>
  // 初始化 Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyByFoQX50OAAYqtaw269aHLcvtuluuvjgc",
    authDomain: "searchingforjws.firebaseapp.com",
    databaseURL: "https://searchingforjws-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "searchingforjws",
    storageBucket: "searchingforjws.firebasestorage.app",
    messagingSenderId: "150080883645",
    appId: "1:150080883645:web:0338463776f07c603260d4",
    measurementId: "G-Z7FHGNZPNL"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // 全局变量
  let isAdmin = false;
  const n = 48;
  const grid = document.getElementById('grid');
  const popup = document.getElementById('popup');
  const popupContent = document.getElementById('popup-content');

  // 初始化格子
  for (let i = 1; i <= n; i++) {
    const cell = document.createElement('div');
    cell.className = 'cell';
    cell.innerText = 'Q' + i;
    cell.onclick = () => openQuestion(i);
    grid.appendChild(cell);
  }

  // 刷新格子状态
  function refreshGrid() {
    db.ref('questions').once('value').then(snapshot => {
      const data = snapshot.val() || {};
      document.querySelectorAll('.cell').forEach((cell, i) => {
        const key = 'Q' + (i + 1);
        if (data[key]) cell.classList.add('used');
        else cell.classList.remove('used');
      });
    });
  }
  refreshGrid();

  // 管理员模式
  window.addEventListener('keydown', e => {
    if (e.key === '/') {
      let input = prompt('输入 /admin 进入管理员模式：');
      if (input === '/admin') {
        const pw = prompt('管理员密码：');
        if (pw === 'jws0522') {
          isAdmin = true;
          alert('进入管理员模式');
          addAdminClearButton(); // 登录成功后添加按钮
        } else alert('密码错误');
      }
    }
  });

  // 管理员清空所有问答按钮
  function addAdminClearButton() {
    const clearBtn = document.createElement('button');
    clearBtn.innerText = '清空所有问答';
    clearBtn.style.position = 'fixed';
    clearBtn.style.top = '20px';
    clearBtn.style.right = '20px';
    clearBtn.style.backgroundColor = '#9C3D34';
    clearBtn.style.color = 'white';
    clearBtn.style.padding = '10px 15px';
    clearBtn.style.border = 'none';
    clearBtn.style.borderRadius = '5px';
    clearBtn.style.cursor = 'pointer';
    clearBtn.style.zIndex = '999';
    clearBtn.onclick = () => {
      if (confirm('确定清空所有问答吗？此操作不可恢复！')) {
        db.ref('questions').remove().then(() => {
          document.querySelectorAll('.cell').forEach(cell => cell.classList.remove('used'));
          alert('已清空所有问答');
        }).catch(err => alert('清空失败: ' + err));
      }
    };
    document.body.appendChild(clearBtn);
  }

  // 打开问题
  function openQuestion(i) {
    const key = 'Q' + i;
    db.ref('questions/' + key).once('value').then(snapshot => {
      const data = snapshot.val();
      if (!data) {
        popupContent.innerHTML = `
          <h3>在 ${key} 提问</h3>
          <textarea id="questionInput" placeholder="写下你的问题..."></textarea>
          <button class="btn-primary" onclick="submitQuestion(${i})">提交</button>`;
      } else {
        if (isAdmin) {
          popupContent.innerHTML = `
            <h3>${key}</h3>
            <p><b>问题：</b>${data.question}</p>
            <p><b>回复：</b>${data.reply || '(还没有回复)'}</p>
            <textarea id="replyInput" placeholder="写下回复..."></textarea>
            <button class="btn-primary" onclick="replyQuestion(${i})">回复</button>`;
        } else {
          const pw = prompt(`请输入密码查看 ${key}`);
          if (pw === data.password) {
            popupContent.innerHTML = `
              <h3>${key}</h3>
              <p><b>问题：</b>${data.question}</p>
              <p><b>回复：</b>${data.reply || '(还没有回复)'}</p>`;
          } else alert('密码错误');
        }
      }
      popup.style.display = 'block';
    });
  }

  // 提交问题
  function submitQuestion(i) {
    const question = document.getElementById('questionInput').value.trim();
    if (!question) return alert('请输入问题！');
    const password = Math.floor(1000 + Math.random() * 9000);
    const key = 'Q' + i;
    db.ref('questions/' + key).set({ question, password: password.toString(), reply: "" });
    document.querySelectorAll('.cell')[i-1].classList.add('used');
    popupContent.innerHTML = `<p>你的问题已提交！请记住密码：<b>${password}</b></p>`;
  }

  // 回复问题（管理员）
  function replyQuestion(i) {
    const reply = document.getElementById('replyInput').value.trim();
    if (!reply) return alert('请输入回复内容');
    const key = 'Q' + i;
    db.ref('questions/' + key + '/reply').set(reply);
    alert('回复成功！');
    popup.style.display = 'none';
  }

  function closePopup() { popup.style.display = 'none'; }

  // 图片轮播
  const imgs = document.querySelectorAll('#image-box img');
  let current = 0;
  function cycleImages() {
    imgs[current].classList.remove('active');
    current = (current + 1) % imgs.length;
    imgs[current].classList.add('active');
    setTimeout(cycleImages, 5000 + Math.random() * 5000);
  }
  setTimeout(cycleImages, 5000);
</script>
</body>
</html>


